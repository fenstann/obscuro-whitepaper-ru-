## Состояние
Obscuro - это децентрализованная, равномерно распределённая система L2, основанная на счетах, подобной L1 блокчейну Ethereum, где состояние вычисляется независимо каждой нодой, на основе канонического списка транзакций и хранения в виде Дерева Патриция в каждом роллапе. Каждая нода обрабатывает все предыдущие транзакции для определения текущего состояния (полная синхронизация), при этом, также вероятно, что будут поддерживаться оптимизированные методы синхронизации (например, ускоренная синхронизация). Существенным отличием является то, что остатки на счетах могут быть рассчитаны только внутри TEE'ов и будут раскрыты только при определенных условиях. Модель не описывается далее в этом документе, поскольку она аналогична модели [счетов на Ethereum](https://ethereum.org/en/developers/docs/accounts/).

Форматы транзакций и смарт-контрактов аналогичны Ethereum, с некоторыми отличиями, вызванными требованиями конфиденциальности.

### Смарт-контракты и ВМ Obscuro
Разработчики приложений на Obscuro будут писать смарт-контракты на привычном языке программирования, используя знакомые инструменты и концепции блокчейна. 
Из-за соображений конфиденциальности данных, существующие смарт-контракты придется изменить, прежде чем внедрять их в Obscuro.

Для реализации этих требований, Obscuro поддерживает среду исполнения, в значительной степени совместимую с _Виртуальной Машиной Ethereum_ (EVM) и производную от существующей реализации, такой как [Geth](https://github.com/ethereum/go-ethereum), являющий каноническим клиентом в протоколе Ethereum.

На высоком уровне, _Виртуальная Машина Obscuro_ (OVM) будет практически идентична EVM, но на заднем техническом плане будут существенные различия между структурами данных, используемыми Ethereum и Obscuro. Структура роллапов также значительно отличается от структуры блоков Ethereum, поскольку содержит зашифрованные транзакции, инструкции по выводу средств в открытом виде, события в открытом виде, ссылки на блоки L1 и многое другое. Со временем, OVM введет новые абстракции и примитивы, чтобы отразить требования конфиденциальности данных и реализовать изоляцию данных там, где это необходимо. Последнее существенное отличие от EVM заключается в реализации требований криптографии Obscuro.

### Конфиденциальность Состояния между Смарт-Контрактами
Основной целью Obscuro является защита пользовательских данных. Если бы смарт-контракты были полностью изолированы друг от друга, было бы легко определить правила доступа к данным.

Композиционность контрактов вносит значительную сложность. DeFi пользуется огромным успехом благодаря способности контрактов объединяться неожиданным образом, не предусмотренным создателем контракта, и Obscuro намеривается повторить это.

Например, один контракт мог быть написан так, чтобы раскрывать информацию только для глаз вызывающего лица в зашифрованном варианте. Но если вызывающий это другой контракт, то этот обёрнутый контракт может превратить ответ в публичное широковещательное событие, видимое всем.

Данная область все еще находится в стадии активного исследования. Первая версия Obscuro будет полагаться на разработчиков приложений, которые будут программно проверять, кто может вызывать различные функции и какие данные они должны получать, и поэтому разработчики должны рассуждать о том, что может произойти, если их контракт будет вызван иным контрактом, который они не контролируют.

В последующих версиях Obscuro рассматривает следующие концепции:
* Каждый контракт может декларативно составлять "белый список" контрактов, которые могут обращаться к различным его функциям.
* Автоматическое распространение доступа. Например, если функция _Account.getBalance()_ может быть вызвана только владельцем, это означает, что любой контракт, вызывающий эту функцию, должен исходить из сообщения, подписанного владельцем. Это решение звучит привлекательно, но необходимо провести дополнительные исследования, чтобы определить, предотвращает ли этот механизм полезные случаи использования.

###  Кошельки и Подтверждение Транзакций
Кошельки пользователей создают транзакции, зашифрованные _Открытым ключом Obscuro_. Только действительные TEE (т.е. агрегаторы и проверяющие), обладающие главным-seed, могут расшифровывать, выполнять и видеть результирующее состояние. Тем не менее, конечные пользователи, отправившие транзакцию, должны иметь возможность получить результат и запросить баланс.

Традиционный кошелек, подключенный к ноде открытого блокчейна, может считывать баланс любого счета и показывать его пользователю. Для обеспечения аналогичного пользовательского опыта, кошельки с поддержкой Obscuro, должны отправлять подписанные запросы на ноды L2 и получать ответы, которые они смогут показывать пользователю. Ответы должны быть зашифрованы ключом пользователя и должны обладать криптографическим доказательством связью баланса с роллапом.

Проверка достоверности таких доказательств может быть выполнена путем проверки сначала подписи TEE, а затем путем проверки того, что роллап находится в основной цепи одного из вариантов между L2 и L1.

###  Типы Смарт-Контрактов
Since all data is temporarily private, and smart contracts are just data, the Obscuro model supports two types of smart contracts.

 - _Открытые контракты_, которые эквивалентны смарт-контрактам на Ethereum в том смысле, что исходный код будет доступен всегда, и любой желающий сможет создать их и сравнить хэш байткода с адресом, на который он посылает команды.

 - _Приватные контракты_, для которых разработчик не опубликовал исходный код. Они могут использоваться для пользовательской логики, такой как арбитраж, когда разработчик намерен сохранить стратегию получения прибыли в тайне от конкурентов.
