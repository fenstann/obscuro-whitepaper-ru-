# Модель рисков
Obscuro отличается от традиционных решений L1 или L2 прежде всего тем, что данные хранятся и обрабатываются конфиденциально в доверенных средах исполнения, что несет в себе новый набор рисков. По сравнению с другими L2-решениями, децентрализованный характер протокола на POBI также несет в себе некоторые новые угрозы.

Основной угрозой для любой технологии распределенного реестра является повреждение данных, также известное как сбой в безопасности. Оно может принимать форму кражи активов, двойного расходования активов или, в более общем случае, добавления противозаконных данных. Ведущие блокчейны решают эту проблему путем реализации Byzantine Fault Tolerant (BFT) консенсуса между независимыми сторонами и созданием стимулов, гарантирующих, что любой, кто нарушит правила, не будет вознагражден или даже будет наказан. Самой экстремальной атакой является атака 51% под названием Sybil, в которой, когда атакующий каким-то образом получает большинство веса голоса на принятие решений (вычислительная мощность для _proof of work_ или доля стэйка для _proof of stake_) и может переписать историю. Эта атака проявляется в замене существующей действительной транзакции действительной конкурирующей транзакцией. Хотя распределенный реестр остается _Логически_ достоверным, это эквивалентно краже для бенефициара первой его транзакции. Если злоумышленник попытается _физически_ повредить распределенный реестр, все будут игнорировать недействительный блок. Лучшей защитой от этой атаки является обеспечение того, чтобы у нескольких независимых влиятельных участников не было стимула для сговора.

Общий принцип протокола Obscuro заключается в том, что в случае взлома технологии TEE, он возвращается к поведению типичного неконфиденциального блокчейна. Другими словами, безопасность распределенного реестра не зависит от устойчивости TEE; вместо этого происходит то, что злоумышленники могут изучать транзакции и данные. Кроме того, Obscuro не делегирует безопасность одному субъекту, планируя поддерживать TEE от нескольких изготовителей оборудования. В случае серьезных атак, существует множество механизмов смягчения последствий, конечным из которых является то, что распределенный реестр на L2 замораживается, и каждый имеет возможность выйти из нее, используя подтверждение подлинности своего баланса.

Obscuro достигает доступности данных таким же образом, как и все другие решения на роллапах; L1 является источником достоверных данных для сети L2. Любой узел L2 с действующим TEE, владеющий общим секретом, может загрузить цепочку роллапов из L1, вычислить все состояние в своей зашифрованной памяти, и в то же время проверить все транзакции.

В следующих разделах анализируются различные угрозы для протокола Obscuro.

## Риски для технологии TEE
При разработке Obscuro учитывалось, что технологию TEE и программу, находящуюся в ней, нелегко взломать, поэтому протокол не оптимизирован для работы с ними. Атаки на TEE происходили в искусственном поле, поэтому второстепенной, но не менее важной задачей является предотвращение того, чтобы сверхсложные субъекты, способные взломать эту технологию, могли украсть средства или нарушить целостность распределенного реестра.

_Модель рисков для Obscuro заключается в том, что изощренные злоумышленники запускают ноду-агрегатор на машине с TEE, которую они контролируют, после получают доступ к seed фразам и всему распределенному реестру, а далее проводят любые возможные атаки на него, включая атаки на CPU._

Предполагая, что такие атаки будут успешными, злоумышленник может ограничиться доступом на уровне чтения или попыткой повредить распределенный реестр с помощью атаки на уровне записи.

### Атаки на уровне чтения
Взломы на уровне чтения происходят, когда злоумышленник может извлечь некоторую информацию из TEE. Эта угроза характерна для конфиденциальных блокчейнов.

Единственный способ защиты от этих атак - тщательный аудит кода и поддержание в актуальном состоянии _Аттестационных Ограничений_. Если атакующий будет действовать незаметно, утечка информации может продолжаться до тех пор, пока не будет опубликовано программное исправление или пока не будет выпущено новое оборудование, устраняющее эту атаку.

Другой способ защиты от нее, который будет рассмотрен в будущих версиях, заключается в реализации схемы, аналогичной ротации ключей.

Наименее серьезная атака на уровне чтения - это побочный канал, по которому злоумышленник может получить информацию о конкретной транзакции. Наиболее серьезной является атака, когда злоумышленник может извлечь главный ключ и прочитать все настоящие и будущие транзакции.

Если такая атака завершится успешна, сеть станет эквивалентна типичным публичным блокчейнам, где все транзакции публичны, и MEV станет возможным.

### Атаки на уровне записи
Теоретически взломы на уровне _записи_ являются мощными, поскольку они могут позволить злоумышленнику записывать данные в распределенный реестр, и таким образом нарушить ее целостность, если нет других средств защиты.

Взлом на уровне записи может произойти, если злоумышленник извлечет ключ анклава и подпишет созданные вручную роллапы, содержащие недействительные транзакции или балансы.

_Примечание: Этот тип атаки рассматривается как основная угроза протоколу и поэтому обрабатывается в особом порядку._

Механизм предотвращения этой атаки подробно описан в разделе [Снятие средств](./obscuro-ethereum-interaction#withdrawals).

Высокоуровневой целью защиты является преобразование такой атаки в атаку на функцию снятия средств.

### Colluding Write-Level Attacks
Экстремальный вариант атаки на _Уровне записи_ осуществляется мощной группой, которая взломала TEE и смогла взять под полный контроль все ноды -агрегатора.

Защита от этой атаки заключается в том, чтобы стимулировать разумное количество верификаторов следить за распределенным реестром Obscuro в режиме реального времени. Эти агенты обнаружат вредоносный накопитель в роллапе и заметят, что не публикуются никакие другие корректные форки.

_Примечание: Одним из таких субъектов, следящих за сетью, будет Obscuro Foundation, который уполномочен поддерживать корректное функционирование протокола. Протокол также поощряет другие независимые стороны за выполнение этой работы, назначая случайные вознаграждения верификаторам, которые могут доказать, что они активны._

Любая нода на L2 может быстро стать Агрегатором, пользуясь устойчивостью цензуры на Ethereum. Чтобы отразить атаку, им придется оплатить стейком и опубликовать корректный роллап.

### Атаки против честной лотереи, которая определяет победителя в раунде

Протокол POBI назначает лидера в каждом раунде с помощью случайных чисел, генерируемых внутри TEE. Злоумышленник, способный взломать технологию, может сгенерировать хорошо подобранное число и таким образом выигрывать каждый раунд. Это не является атакой на безопасность распределённого реестра и не вызывает особого беспокойства.

Если какой-то агрегатор выиграет по статистике намного больше раундов, чем должен, это привлечет внимание сообщества к проблеме.

Более опасный вариант атаки - когда атакующий может также читать транзакции и, таким образом, опережать их и извлекать из этого ценность.

_Примечание: Эта сфера находится в стадии исследования._.

Разновидностью этой атаки также является ситуация, когда злоумышленник не может напрямую взломать TEE, но перезапускает его в надежде сгенерировать более низкий nonce, тем самым повышая свои шансы. Эта угроза ослабляется задержкой, вводимой при запуске OVM, в результате чего атакующий пропустит этот цикл на роллапах.

## Другие угрозы для протокола
В этом разделе анализируются угрозы, не связанные напрямую с TEE, хотя взлом TEE может их усилить.

### Атаки на некорректный роллап
_Контракт роллапов_ принимает подписанные роллапы только от агрегаторов, которые могут подтвердить свою достоверность TEE, и если только сам TEE не поврежден; опубликовать недействительные роллапы невозможно. Это означает, что такая атака станет "атакой на живучесть" при обнаружении форков в цепочке роллапов.

### Атаки на пустые роллапы
Агрегатор, выигравший раунд, может свободно публиковать пустые роллапы, но это не повредит системе, если есть несколько независимых агрегаторов. Это просто замедлит работу сети. Obscuro не поощряет эту атаку, поскольку вознаграждение публикатора связаны с комиссией, собранной с включенных в неё транзакций.

## Атаки Sybil
В этом разделе анализируются угрозы, которые могут представлять для протокола мощные проблемы, способные на создание множества Агрегаторов.

Обоснование этой атаки значительно отличается от типичных публичных блокчейнов.

Существует два способа проведения этой атаки на Obscuro в зависимости от возможностей атакующего:

1. Атакующий устанавливает N-число процессоров с TEE и платит стейк за каждый из них, где (N > Общее_Число_Агрегаторов / 2).
2. Атакующий взламывает TEE и может выдавать себя за множество TEE, ограниченными только размером стейка. Эта атака была проанализирована в статье "Атака на уровне сговора при записи".

### Атака Sybil без взлома TEE
Если атакующий не может взломать TEE, он не может отступить от основной цепи или вставить незаконные транзакции, так как проверенное программное обеспечение не позволит ему этого сделать. Наличие большинства в сети Obscuro не поможет в этом вопросе. Злоумышленник, который хочет провести атаку с двойной-затратой на Obscuro, должен будет изменить основную цепь, уже опубликованную в блоках L1. Чтобы выполнить двойную-затрату, злоумышленники должны выполнить атаку на сами блоки в L1, которые содержат роллапы.

### Экономические Sybil атаки
Другой тип атаки, которую может осуществить злоумышленник с хорошими ресурсами - это контроль над многими Агрегаторами, чтобы получить хорошую прибыль от вознаграждения. Чем больше Агрегаторов кто-то контролирует, тем больше шансов получить выигрышный nonce.

Нет никакого риска в изменении распределенного реестра или проведение атак с двойными-затратами средств. Также отсутствует риск атаки типа "отказ в обслуживании", путем отказа публиковать выигравшие роллапы, поскольку стимулы побуждают других участников быстро заполнять пробелы и опубликовать корректные роллапы.

Нет риска вывести из системы других Агрегаторов, отказав им в возможности побеждать при выборе роллапа, поскольку они получат вознаграждение за то, что являются активными нодами.

### Катастрофические события
Одним из худших сценариев является катастрофическое событие, в результате которого вся ликвидность будут заблокирована.

Теоретически это может произойти, если все зарегистрированные TEE будут одновременно физически уничтожены, и таким образом основные seed-фразы будут навсегда потеряны.

Если ни один TEE не был физически уничтожен, а у одного узла Ethereum есть копия распределенного реестра L1, сеть может быть перезапущена, поскольку вся необходимая информация хранится на L1, включая основные seed-фразы, зашифрованные ключом выжившего анклава, а также, все роллапы.

Защита от этого заключается в достижении разумной децентрализации.

## MEV от Obscuro Агрераторов
Транзакции и обработка скрыты от нод-операторов. Тем не менее, роллапы содержат некоторую информацию, и нода-оператор может запросить баланс счетов, которые он контролирует.

Чтобы сделать эту атаку бесполезной, Obscuro вводит небольшую задержку, которая сохраняет пользовательский опыт публичных блокчейнов.

TEE будет публиковать события и отвечать на запросы о балансе только после того, как получит доказательство того, что роллап был успешно опубликован в блоке в L1. Этот механизм не позволит агрегатору запрашивать информацию во время создания роллапа.

Агрегатор, желающий атаковать эту схему, должен будет быстро создавать действительные блоки Ethereum во время выполнения пользовательских транзакций, что крайне непрактично, поскольку существует фиксированно-заданное минимальное значение сложности майнинга.

## Угрозы для протокола на POBI
Протокол POBI справляется с большинством сценариев сбоев с помощью наборов для правил стимулирования.

#### 1. Выигравший секвенсор не производит роллапы
Победивший агрегатор стимулируется опубликовать роллап, чтобы получить вознаграждение, что означает, что этот сценарий должен происходить нечасто, только если агрегатор выходит из строя или становится неисправныи. Если это произойдет, то другие Агрегаторы обнаружат это только тогда, когда следующий блок в L1 не будет содержать выигравший роллап, о котором сплетничали.

В этой ситуации каждый Агрегатор будет:

* Откажется от текущего роллапа.
* Разблокирует предыдущий роллап.
* Добавит к нему все текущие транзакции.
* Затем введет его, используя последний пустой блок.
* Распространите это.

По сути, это означает, что предыдущий раунд переигрывается. Агрегатор-победитель этого нового раунда имеет приоритет над вознаграждением в случае, если предыдущий победитель будет добавлен в тот же блок.

#### 2. Победивший секвенсор добавляет слишком мало газа, и роллап остается в mempool'е неподтвержденным
Этот сценарий имеет тот же эффект, что и предыдущий, и обрабатывается таким же образом. Если роллап не находится в следующем блоке, раунд переигрывается.

Публикация при недостаточным количестве газа, по сути, наказывается протоколом, поскольку это означает, что помимо упущенной награды за роллап, агрегатор также платит комиссию за газ в L1.

## Конкурирующие Блокчейн-Форки L1
Теоретически, разные агрегаторы L2 могут быть подключены к нодам L1, которые имеют разные представления о распределённом реестре в L1. Это будет видно в сети L2 в виде объединенных роллапов, указывающих на блоки L1 из двух форков. Каждый агрегатор должен будет начать задействовать свой стейк и продолжить работу на том форке L1, который он считает легитимным, - такое же поведение, как и у любой ноды на L1.

Это изображено в [Структуре Rollup Данных](./rollup-data-structure).

Если окажется, что решение, принятое агрегатором, было неверным, он должен откатить состояние до контрольной точки и задействовать выигравшие роллапы.

## Модель доверия
Анализ в этом разделе основан на [структуре](https://vitalik.ca/general/2020/08/20/trust.html) определенной Виталиком Бутериным, создателем Ethereum.

Obscuro несколько отличается от типичных блокчейнов или L2, поскольку вводит в модель доверия еще одного участника - производителя оборудования.

Вот вопросы, на которые мы будем отвечать, используя терминологию фреймворка.

1. Сколько людей вам нужно, чтобы вести себя так, как вы ожидаете? Из скольки идёт выборка?
2. Какие виды мотивации необходимы для поведения этих людей? Должны ли они быть альтруистами или просто стремиться к прибыли? Должны ли они быть нескоординированными?
3. Насколько сильно пострадает система, если предположения будут нарушены?

### Действующие лица
Следующие группы являются действующими лицами в системе.
1. Сеть Obscuro может содержать несколько тысяч нод, из которых основное меньшинство будут составлять агрегаторы, а остальные - проверяющие. Управляющий орган может контролировать это число, задавая некоторые параметры.
2. Другая важная группа - держатели токенов, которые обладают полномочиями управления.
3. Поддерживаемые производители аппаратных TEE.
4. Аудиторы.

### Обозначения
1. Obscuro_N - количество нод Obscuro ~ 1000.
2. Ethereum_N - количество нод Ethereum.
3. TEE_Manufacturer_N - количество производителей. Небольшое количество, но состоит из крупных авторитетных компаний.
4. Token_Holders_N - количество держателей токенов Obscuro. Множество тысяч.

### Жизнеспособность
При анализе модели доверия жизнеспособности, необходимо учитывать множество аспектов. Поскольку Obscuro полностью децентрализована на уровне сети, пока жив хоть один агрегатор, сеть жива и обрабатывает транзакции пользователей.

Для обработки транзакций: 1 из Obscuro_N, где мотивацией узлов является стремление к прибыли.

Для обработки снятия средств и, таким образом, достижения конечного результата, анализ более сложен. Поскольку снятие средств обрабатывается автоматически на основе заданных инструкций, найденных в роллапах, модель доверия для жизнеспособности этой функции, является моделью безопасности.

### Безопасность
Безопасность Obscuro основана на паре уровней, которые преобразуют атаку на безопасность в атаку на жизнеспособность.

Обратите внимание, что безопасность распределенного реестра находится под угрозой только в случае взлома конфиденциальной аппаратной части.

Учитывая, что производители аппаратного обеспечения, как правило, являются крупными и авторитетными компаниями, они выступают в качестве первого барьера. Их мотивацией является стремление к прибыли, поскольку уязвимости в созданном ими оборудовании приведут к снижению продаж и ухудшению репутации.

Аппаратный уровень: 1 из TEE_Manufacturer_N, где мотивацией является стремление к прибыли. Обратите внимание, что здесь предполагается, что производитель оборудования внедряет ошибку в реализацию TEE для атаки на распределенный реестр. Обычно угроза ниже, поскольку один пользователь с действующим TEE любого производителя сможет остановить атаку.

Если атака на TEE будет успешной, следующей защитой будет один активный узел на L2, который опубликует корректный роллап. 1 из Obscuro_N, где мотивацией нод является стремление к прибыли.

Следующая линия обороны - держатели токенов, которые будут голосовать на L1 за обновление Аттестационных Ограничений, чтобы устранить уязвимость. Они инвестируют в сообщество, так как являются держателями токена, а значит, получают прибыль, если он функционирует правильно: Держатели_Токена_N/2 от Держатели_Токена_N, где мотивация - стремление к прибыли.

Обратите внимание, что атакующий не стремится напрямую получить прибыль, потому что нет возможности вывести активы, пока форк не будет ликвидирован.

### Насколько сильно откажет система, если предположения будут нарушены? 
Если все производители поддерживаемого оборудования вступят в сговор, они смогут нарушить безопасность распределённого реестра.
